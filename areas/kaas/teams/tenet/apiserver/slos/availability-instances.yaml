---
description: "API server instance status SLO"
alertName: "ApiServerInstanceUnavailable"
objective: 95 # We want to maintain 95% availability, allowing for 1 out of 3 control planes to go down for brief periods without triggering an alert.
sharedAccrossProviders: true
# Error Query: We calculate downtime (1 - avg uptime) over a certain time window and consider the control plane unhealthy if it's down more than 33% of the time.
# The sum is used to count how many control planes exceed this threshold of downtime.
# This avoids alerts for brief downtimes of a single control plane but triggers when 2 or more are down.
errorQuery: '{{`sum((1 - avg_over_time(up{job="apiserver"}[{{.window}}])) > 0.33) by (cluster_id, cluster_type, customer, installation, pipeline, provider, region) `}}'
# Total Query: We count the total number of control planes to compare against the number of down instances.
# This gives us the total set of control planes to ensure the "errorQuery" can be normalized across all instances in the cluster.
totalQuery: '{{`count(avg_over_time(up{job="apiserver"}[{{.window}}])) by (cluster_id, cluster_type, customer, installation, pipeline, provider, region)`}}'
alertLabels:
  cancel_if_cluster_status_updating: "true"
  cancel_if_monitoring_agent_down: "true"
  cancel_if_outside_working_hours: '{{ include "workingHoursOnly" . }}'
annotations:
  runbook_url: service-level-burn-rate-too-high/
