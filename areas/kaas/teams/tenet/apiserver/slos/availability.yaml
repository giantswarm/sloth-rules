---
description: "API availability SLO"
alertName: "ApiServerAvailabilityErrorRateTooHigh"
objective: 99
sharedAccrossProviders: true
# Counts 5xx and 429 errors as failures. 
# If the API server is completely down (up = 0), we consider it a 100% error rate.
errorQuery: '{{`sum(rate(apiserver_request_total{code=~"(5..|429)"}[{{.window}}])) by (cluster_id, cluster_type, customer, installation, pipeline, provider, region) or clamp_min(1 - sum(up{job="apiserver"}) by (cluster_id, cluster_type, customer, installation, pipeline, provider, region), 0)`}}'
# Counts all API server requests as the baseline. 
# Uses clamp_min to prevent divide-by-zero, especially for single-master clusters.
totalQuery: '{{`sum(rate(apiserver_request_total[{{.window}}])) by (cluster_id, cluster_type, customer, installation, pipeline, provider, region) or clamp_min(1 - sum(up{job="apiserver"}) by (cluster_id, cluster_type, customer, installation, pipeline, provider, region), 0.01)`}}'
alertLabels:
  cancel_if_cluster_status_updating: "true"
  cancel_if_monitoring_agent_down: "true"
  cancel_if_outside_working_hours: '{{ include "workingHoursOnly" . }}'
annotations:
  opsrecipe: service-level-burn-rate-too-high/
