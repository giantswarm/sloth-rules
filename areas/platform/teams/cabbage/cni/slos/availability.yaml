---
description: "Cilium availability SLO"
alertName: "CiliumAvailability"
objective: 99
# number of desired cilium pods that are down (kube_daemonset_status_number_unavailable > 0)
errorQuery: '{{`((last_over_time(kube_daemonset_status_number_unavailable{namespace="kube-system", daemonset="cilium"}[{{.window}}]) > 0) and on (cluster_id, cluster_type, customer, installation, pipeline, provider, region, daemonset) (kube_daemonset_status_number_unavailable{namespace="kube-system", daemonset="cilium"} offset 10m) > 0) unless on (cluster_id, cluster_type, customer, installation, pipeline, provider, region) (time() - kube_node_created < 600)`}}'
# total number of desired daemonsets pods
totalQuery: '{{`sum_over_time(kube_daemonset_status_desired_number_scheduled{namespace="kube-system", daemonset="cilium"}[{{.window}}])`}}'
annotations:
  runbook_url: https://intranet.giantswarm.io/docs/support-and-ops/ops-recipes/cilium-troubleshooting/
  __dashboardUid__: vtuWtdumz
  dashboardQueryParams: orgId=1
  description: '{{`At least one cilium-agent down for more than 10 minutes.`}}'
alertLabels:
  cancel_if_cluster_status_updating: "true"
  cancel_if_monitoring_agent_down: "true"
  cancel_if_outside_working_hours: "true"
